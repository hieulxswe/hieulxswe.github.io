---
title: "Long Weekend: Cafe & tá»‘i Æ°u há»‡ thá»‘ng P.1"
date: 2023-09-30T00:00:00+00:00
author: Hieu Xuan Leu
layout: post
permalink: /long-weekend-cafe-toi-uu-he-thong-p-1/
thumbnail: /assets/images/toiuuhethong.png
categories: backend
tags: [backend, optimzesystem]
---

Sydney, 30 Sep 2023

Xin chÃ o má»i ngÆ°á»i, mÃ¬nh lÃ  Hiáº¿u (aka. Brian) â€“ hiá»‡n táº¡i Ä‘ang sinh sá»‘ng â€“ há»c táº­p & lÃ m viá»‡c táº¡i Sydney. Náº¿u Ä‘Ã¢y lÃ  láº§n Ä‘áº§u báº¡n ghÃ© thÄƒm blog, hÃ£y lá»±a chá»n tab â€œHomeâ€ Ä‘á»ƒ cÃ³ thá»ƒ xem nhá»¯ng bÃ i viáº¿t/chuyÃªn má»¥c mÃ  mÃ¬nh Ä‘Ã£ chia sáº» trÆ°á»›c Ä‘Ã¢y. VÃ  Ä‘á»«ng quÃªn â€œAdd blog to your favoritesâ€ Ä‘á»ƒ cÃ³ thá»ƒ cáº­p nháº­t nhá»¯ng bÃ i viáº¿t má»›i nháº¥t tá»« má»™t ngÆ°á»i â€œXa nhÃ , gáº§n mÃ¡y tÃ­nhâ€ nhÃ©. Cáº£m Æ¡n cÃ¡c báº¡n!

HÃ´m nay lÃ  má»™t ngÃ y cuá»‘i tuáº§n Ä‘áº¹p trá»i. MÃ¬nh dáº­y tá»« 5am â€œhÃ­tâ€ khÃ­ trá»i, vá»‡ sinh cÃ¡ nhÃ¢n, Äƒn sÃ¡ng. Sau Ä‘Ã³ sáº½ â€œlÃªn Ä‘Æ°á»ngâ€ tá»›i thÆ° viá»‡n Ä‘á»ƒ há»c & lÃ m viá»‡c (Tá»« khi sang Ãšc, mÃ¬nh cÃ³ thÃ³i quen lÃ  khi ráº£nh sáº½ lÃªn thÆ° viá»‡n á»Ÿ cÃ¡c Suburb khÃ¡c nhau). Nay mÃ¬nh ngá»“i á»Ÿ Five Dock Library (má»™t thÆ° viá»‡n mÃ  mÃ¬nh yÃªu thÃ­ch ğŸ˜Š).

![alt](https://hieulxswe.com/wp-content/uploads/2023/09/IMG_3691-1-1536x1152.png)

Chia sáº» ngáº¯n vá» báº£n thÃ¢n váº­y thÃ´i, bÃ¢y giá» chÃºng ta cÃ¹ng Ä‘i vÃ o chi tiáº¿t bÃ i viáº¿t nhÃ©! Letâ€™s goooooo â€¦

á» trong bÃ i viáº¿t nÃ y, mÃ¬nh sáº½ chia sáº» Ä‘Ã´i chÃºt kinh nghiá»‡m cÃ¡ nhÃ¢n & tham kháº£o tá»« cÃ¡c nguá»“n vá» viá»‡c thiáº¿t káº¿ & tá»‘i Æ°u há»‡ thá»‘ng â€œphá»¥c vá»¥ hÃ ng triá»‡u ngÆ°á»i dÃ¹ngâ€.

NhÆ° chÃºng ta Ä‘Ã£ biáº¿t, viá»‡c thiáº¿t káº¿ há»‡ thá»‘ng Ä‘á»ƒ phá»¥c vá»¥ hÃ ng triá»‡u ngÆ°á»i dÃ¹ng lÃ  má»™t thá»­ thÃ¡ch khÃ³ & khÃ´ng cÃ³ cÃ¢u tráº£ lá»i chÃ­nh xÃ¡c (nÃ³ giá»‘ng nhÆ° viá»‡c: â€œDev tÃ¡n gÃ¡iâ€, â€œPhá»¥ ná»¯ Ä‘áº¿n thÃ¡ngâ€, â€¦. ğŸ¤£). VÃ¬ váº­y, chÃºng ta cÃ¹ng Ä‘á»c â€“ tÃ¬m hiá»ƒu & gÃ³p Ã½ cho nhau nhÃ©!

## Táº¡i sao khÃ³?
Äá»ƒ thiáº¿t káº¿ má»™t há»‡ thá»‘ng cho 5-10 ngÆ°á»i sá»­ dá»¥ng thÃ¬ vÃ´ cÃ¹ng Ä‘Æ¡n giáº£n. Tuy nhiÃªn, khi scope lÃªn hÃ ng trÄƒm, nghÃ¬n, trÄƒm nghÃ¬n â€¦ tháº­m trÃ­ cáº£ triá»‡u ngÆ°á»i dÃ¹ng thÃ¬ láº¡i lÃ  má»™t bÃ i toÃ¡n lá»›n & vÃ´ cÃ¹ng phá»©c táº¡p.

CÃ´ng ty mÃ¬nh cÃ³ ráº¥t nhiá»u portals & roles khÃ¡c nhau (Manager, Staff, Agent, Client â€¦). KhÃ´ng nhá»¯ng tháº¿, há»‡ thá»‘ng cá»§a cÃ´ng ty mÃ¬nh cÃ²n cÃ³ â€œnhiá»‡m vá»¥â€ tiáº¿p nháº­n há»“ sÆ¡ tá»« khÃ¡ch hÃ ng, tÃ­nh toÃ¡n nhá»¯ng â€œthÃ´ng sá»‘â€ cho khÃ¡ch hÃ ng, â€¦. (NÃ³i chung lÃ  Náº¶NG, nhÆ°ng vÃ¬ lÃ½ do báº£o máº­t nÃªn mÃ¬nh khÃ´ng tiá»‡n chia sáº» á»Ÿ Ä‘Ã¢y). VÃ  táº¥t nhiÃªn sáº½ khÃ´ng dá»«ng á»Ÿ nhá»¯ng tÃ¡c vá»¥ nÃ y, chÃºng tÃ´i sáº½ luÃ´n luÃ´n scale-up ğŸ‘Œ

VÃ­ dá»¥: Má»™t server bÃ¬nh thÆ°á»ng cÃ³ thá»ƒ tiáº¿p nháº­n vÃ  chá»‹u táº£i Ä‘Æ°á»£c 100 request/s. Khi lÆ°á»£ng request tÄƒng lÃªn khoáº£ng 1000 thÃ¬ chÃºng ta cÃ³ thá»ƒ nÃ¢ng cáº¥p server cÃ³ cáº¥u hÃ¬nh cao & tá»‘t hÆ¡n. NhÆ°ng khi lÆ°á»£ng request lÃªn vÃ i trÄƒm ngÃ n hoáº·c cáº£ triá»‡u request thÃ¬ viá»‡c nÃ¢ng cáº¥p server lÃ  Ä‘iá»u â€œgáº§n nhÆ° khÃ´ng thá»ƒâ€, lÃºc nÃ y báº¯t buá»™c chÃºng pháº£i thiáº¿t káº¿ & tá»‘i Æ°u sao cho nhiá»u server cháº¡y cÃ¹ng lÃºc

## Má»™t sá»‘ yáº¿u tá»‘ quan trá»ng cá»§a má»™t há»‡ thá»‘ng
Khi thiáº¿t káº¿ há»‡ thá»‘ng, cÃ³ 3 yáº¿u tá»‘ quan trá»ng mÃ  chÃºng ta cáº§n Ä‘á»ƒ Ã½ Ä‘Ã³ lÃ : Performance, Availability vÃ  Scalability.

![alt](https://hieulxswe.com/wp-content/uploads/2023/09/image.png)

* Performance (Hiá»‡u suáº¥t): Tá»‘c Ä‘á»™ pháº£n há»“i cá»§a há»‡ thá»‘ng. ÄÆ°á»£c tÃ­nh báº±ng Ä‘Æ¡n vá»‹ thá»i gian (s hoáº·c ms).
* Availability (Kháº£ dá»¥ng): Ä‘á» cáº­p Ä‘áº¿n kháº£ nÄƒng cá»§a há»‡ thá»‘ng hoáº·c dá»‹ch vá»¥ Ä‘á»ƒ hoáº¡t Ä‘á»™ng vÃ  sáºµn sÃ ng sá»­ dá»¥ng khi cáº§n thiáº¿t, mÃ  khÃ´ng gáº·p sá»± cá»‘ hoáº·c giÃ¡n Ä‘oáº¡n lá»›n.
* Scalability (Má»Ÿ rá»™ng): Kháº£ nÄƒng má»Ÿ rá»™ng cá»§a há»‡ thá»‘ng.

Performance Ä‘áº·c biá»‡t quan trá»ng vÃ  cáº§n thiáº¿t Ä‘á»ƒ Ä‘áº£m báº£o ngÆ°á»i dÃ¹ng cá»§a báº¡n cÃ³ thá»ƒ cÃ³ tráº£i nghiá»‡m tá»‘t nháº¥t trÃªn cáº£ nhá»¯ng thiáº¿t bá»‹ Ä‘iá»‡n thoáº¡i (cÃ³ CPU vÃ  power tháº¥p). Viá»‡c sá»‘ lÆ°á»£ng ngÆ°á»i dÃ¹ng Ä‘iá»‡n thoáº¡i ngÃ y cÃ ng nhiá»u vÃ  sá»‘ lÆ°á»£ng ngÆ°á»i dÃ¹ng truy cáº­p website thÃ´ng qua di Ä‘á»™ng thÃ¬ nhá»¯ng website cáº§n Ä‘Æ°á»£c tá»‘i Æ°u tá»‘t hÆ¡n Ä‘á»ƒ Ä‘Ã¡p á»©ng lÆ°á»£ng ngÆ°á»i dÃ¹ng nÃ y.

## CÃ¢n báº±ng táº£i vá»›i Load Balancer
Bá»™ cÃ¢n báº±ng táº£i (Load Balancer) phÃ¢n phá»‘i Ä‘á»“ng Ä‘á»u lÆ°u lÆ°á»£ng truy cáº­p giá»¯a cÃ¡c web server Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh trong bá»™ cÃ¢n báº±ng táº£i. Xem hÃ¬nh cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a bá»™ cÃ¢n báº±ng táº£i.

![alt](https://hieulxswe.com/wp-content/uploads/2023/09/image-1.png)

á» hÃ¬nh trÃªn, ngÆ°á»i dÃ¹ng káº¿t ná»‘i trá»±c tiáº¿p vá»›i Ä‘á»‹a chá»‰ IP public cá»§a bá»™ cÃ¢n báº±ng táº£i. Vá»›i thiáº¿t láº­p trÃªn, web server khÃ´ng thá»ƒ tiáº¿p cáº­n trá»±c tiáº¿p bá»Ÿi client. Äá»ƒ báº£o máº­t tá»‘t hÆ¡n, IP private Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ giao tiáº¿p giá»¯a cÃ¡c server. Má»™t IP private lÃ  má»™t Ä‘á»‹a chá»‰ IP cÃ³ thá»ƒ tiáº¿p cáº­n giá»¯a cÃ¡c server trong cÃ¹ng má»™t máº¡ng nhÆ°ng khÃ´ng thá»ƒ tiáº¿p cáº­n tá»« internet bÃªn ngoÃ i. Bá»™ cÃ¢n báº±ng táº£i giao tiáº¿p vá»›i cÃ¡c web server thÃ´ng qua IP private.

Sau bá»™ cÃ¢n báº±ng táº£i lÃ  hai web server, nhÆ° váº­y lÃ  ta Ä‘Ã£ giáº£i quyáº¿t Ä‘Æ°á»£c váº¥n Ä‘á» chuyá»ƒn Ä‘á»•i tá»± Ä‘á»™ng vÃ  cáº£i thiá»‡n tÃ­nh kháº£ dá»¥ng cá»§a web.
* Náº¿u server 1 ngoáº¡i tÃ­nh, truy cáº­p sáº½ Ä‘Æ°á»£c chuyá»ƒn sang server 2. Äiá»u nÃ y ngÄƒn cháº·n viá»‡c website sáº­p. Ta cÅ©ng sáº½ thÃªm má»™t web server khoáº» máº¡nh má»›i vÃ o Ä‘á»ƒ cÃ¢n báº±ng táº£i.
* Náº¿u lÆ°u lÆ°á»£ng truy cáº­p web tÄƒng máº¡nh, hai server lÃ  khÃ´ng Ä‘á»§ Ä‘á»ƒ xá»­ lÃ½, bá»™ cÃ¢n báº±ng táº£i cÃ³ thá»ƒ xá»­ lÃ½ váº¥n Ä‘á» nÃ y má»™t cÃ¡ch gá»n gÃ ng. Báº¡n chá»‰ cáº§n thÃªm server vÃ o nhÃ³m web server bá»™ cáº­n báº±ng táº£i sáº½ tá»± Ä‘á»•i gá»­i yÃªu cáº§u Ä‘áº¿n nÃ³.

## PhÃ¢n tÃ¡n dá»¯ liá»‡u vá»›i Content Delivery Network (CDN)
Content delivery network (CDN) lÃ  má»™t nhÃ³m server Ä‘áº·t táº¡i nhiá»u vá»‹ trÃ­ khÃ¡c nhau Ä‘á»ƒ há»— trá»£ ná»™i dung Ä‘Æ°á»£c tráº£i dÃ i á»Ÿ nhiá»u khu vá»±c vá»‹ trÃ­ Ä‘á»‹a lÃ½ khÃ¡c nhau.

Báº±ng cÃ¡ch phÃ¢n tÃ¡n há»‡ thá»‘ng trÃªn má»™t khu vá»±c rá»™ng lá»›n, website cÃ³ thá»ƒ giáº£m thiá»ƒu lÆ°á»£ng bÄƒng thÃ´ng tiÃªu thá»¥ vÃ  thá»i gian táº£i trang, Ä‘á»“ng thá»i cÃ³ kháº£ nÄƒng xá»­ lÃ½ Ä‘Æ°á»£c nhiá»u request Ä‘á»“ng thá»i.

![alt](https://hieulxswe.com/wp-content/uploads/2023/09/image-2.png)

## Caching
LÃ  má»™t ká»¹ thuáº­t tÄƒng Ä‘á»™ truy xuáº¥t dá»¯ liá»‡u vÃ  giáº£m táº£i cho há»‡ thá»‘ng. Cache lÃ  nÆ¡i lÆ°u táº­p há»£p cÃ¡c dá»¯ liá»‡u, thÆ°á»ng cÃ³ tÃ­nh cháº¥t nháº¥t thá»i, cho phÃ©p sá»­ dá»¥ng láº¡i dá»¯ liá»‡u Ä‘Ã£ láº¥y hoáº·c tÃ­nh toÃ¡n trÆ°á»›c Ä‘Ã³, nÃªn sáº½ giÃºp tÄƒng tá»‘c cho viá»‡c truy xuáº¥t dá»¯ liá»‡u á»Ÿ nhá»¯ng láº§n sau.

![alt](https://hieulxswe.com/wp-content/uploads/2023/09/image-3.png)

## Database Replication
Database Replication lÃ  má»™t ká»¹ thuáº­t trong lÄ©nh vá»±c quáº£n trá»‹ cÆ¡ sá»Ÿ dá»¯ liá»‡u (Database Management), Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ táº¡o ra vÃ  duy trÃ¬ cÃ¡c báº£n sao cá»§a cÆ¡ sá»Ÿ dá»¯ liá»‡u gá»‘c (source database) trÃªn cÃ¡c mÃ¡y chá»§ (servers) khÃ¡c nhau. Má»¥c tiÃªu cá»§a Database Replication lÃ  cung cáº¥p sá»± sao lÆ°u dá»¯ liá»‡u, tÄƒng tÃ­nh sáºµn sÃ ng (availability), cáº£i thiá»‡n kháº£ nÄƒng chá»‹u lá»—i (fault tolerance), vÃ  tá»‘i Æ°u hÃ³a hiá»‡u suáº¥t (performance) cá»§a há»‡ thá»‘ng cÆ¡ sá»Ÿ dá»¯ liá»‡u.

ThÃ´ng thÆ°á»ng nÃ³ sáº½ lÃ  má»‘i quan há»‡ Master-Slave giá»¯a báº£n gá»‘c (Master) vÃ  báº£n sao (Slave).

Master chá»‰ há»— trá»£ thao tÃ¡c ghi. CÃ²n cÃ¡c Slave láº¥y dá»¯ liá»‡u sao chÃ©p tá»« cÆ¡ sá»Ÿ dá»¯ liá»‡u Master vÃ  chá»‰ cung cáº¥p thao tÃ¡c Ä‘á»c. Táº¥t cáº£ lá»‡nh chá»‰nh sá»­a dá»¯ liá»‡u nhÆ° INSERT, DELETE vÃ  UPDATE sáº½ Ä‘Æ°á»£c gá»­i vÃ o Master DB. Pháº§n lá»›n á»©ng dá»¥ng Ä‘á»u yÃªu cáº§u truy cáº­p Ä‘á»c nhiá»u hÆ¡n ghi, do Ä‘Ã³ sá»‘ lÆ°á»£ng cÆ¡ sá»Ÿ dá»¯ liá»‡u Slave trong há»‡ thá»‘ng nhiá»u hÆ¡n cÆ¡ sá»Ÿ dá»¯ liá»‡u Master.

![alt](https://hieulxswe.com/wp-content/uploads/2023/09/image-4.png)

Lá»£i Ã­ch cá»§a má»‘i quan há»‡ Master/Slave bao gá»“m:
* Sao lÆ°u dá»¯ liá»‡u: Slave lÆ°u trá»¯ báº£n sao dá»¯ liá»‡u, giÃºp báº£o vá»‡ dá»¯ liá»‡u khá»i máº¥t mÃ¡t trong trÆ°á»ng há»£p sá»± cá»‘ hoáº·c há»ng mÃ¡y chá»§ Master.
* PhÃ¢n phá»‘i táº£i cÃ´ng viá»‡c: Slave cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ Ä‘á»c dá»¯ liá»‡u, giáº£m Ã¡p lá»±c cho mÃ¡y chá»§ Master vÃ  cáº£i thiá»‡n hiá»‡u suáº¥t há»‡ thá»‘ng.
* TÃ­nh nháº¥t quÃ¡n: Slave Ä‘á»“ng bá»™ hÃ³a dá»¯ liá»‡u tá»« Master, Ä‘áº£m báº£o tÃ­nh nháº¥t quÃ¡n giá»¯a cÃ¡c báº£n sao.

## Káº¿t
Táº¡m káº¿t P.1, do thá»i gian cÃ³ háº¡n nÃªn bÃ i viáº¿t nÃ y mÃ¬nh xin táº¡m dá»«ng á»Ÿ Ä‘Ã¢y. Nhá»¯ng ká»¹ thuáº­t bÃªn trÃªn chá»‰ mang tÃ­nh cháº¥t tham kháº£o (cÃ²n phá»¥ thuá»™c vÃ o mÃ´ hÃ¬nh hoáº¡t Ä‘á»™ng cá»§a há»‡ thá»‘ng). Náº¿u cÃ¡c báº¡n cÃ³ gÃ³p Ã½ hoáº·c cÃ³ cÃ¡c ká»¹ thuáº­t hay hÆ¡n, hÃ£y bÃ¬nh luáº­n bÃªn dÆ°á»›i Ä‘á»ƒ cÃ¹ng nhau há»c há»i nhÃ©! Have a nice day ~everyone âœŒï¸


